
## **Лабораторная работа. Развертывание коммутируемой сети с резервными каналами.**

**Топология**

![](https://github.com/sefishin/otus_networks/blob/master/labs/lab02/scheme.png)

**Таблица адресации**

| Устройство | Интерфейс | IP-адрес | Маска подсети |
| --- | --- | --- | --- |
| S1 | VLAN 1 | 192.168.1.1 | 255.255.255.0 |
| S2 | VLAN 1 | 192.168.1.2 | 255.255.255.0 |
| S3 | VLAN 1 | 192.168.1.3 | 255.255.255.0 |

**Цели**

**Часть 1. Создание сети и настройка основных параметров устройства**

**Часть 2. Выбор корневого моста**

**Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов**

**Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов**

***


1. **Создание сети и настройка основных параметров устройства**

Стенд развернут и настроен в Cisco Packet Tracer в соответствии с заданной топологией. Файлы конфигураций приложены.

![](https://github.com/sefishin/otus_networks/blob/master/labs/lab02/scheme01.png)


Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S2? \__Да_\_.

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S3? \__Да_\_.

Успешно ли выполняется эхо-запрос от коммутатора S2 на коммутатор S3? \__Да_\_.

---

2. **Определение корневого моста**

  * Отключите все порты на коммутаторах.
  * Настройте подключенные порты в качестве транковых.
  * Включите порты F0/2 и F0/4 на всех коммутаторах.
  * Отобразите данные протокола spanning-tree.
  
        S1#show spanning-tree 
        VLAN0001
           Spanning tree enabled protocol ieee
           Root ID    Priority    32769
                 Address     0005.5E75.E646
                 This bridge is the root
                 Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec

           Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)
                 Address     0005.5E75.E646
                 Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec
                 Aging Time  20

        Interface        Role Sts Cost      Prio.Nbr Type
         ---------------- ---- --- --------- -------- --------------------------------
         Fa0/2            Desg FWD 19        128.2    P2p
         Fa0/4            Desg FWD 19        128.4    P2p

         S2#show spanning-tree
         VLAN0001
           Spanning tree enabled protocol ieee
           Root ID    Priority    32769
             Address     0005.5E75.E646
             Cost        19
             Port        2(FastEthernet0/2)
             Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec

           Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)
             Address     00D0.D3B6.08C6
             Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  20

         Interface        Role Sts Cost      Prio.Nbr Type
         ---------------- ---- --- --------- -------- --------------------------------
         Fa0/4            Altn BLK 19        128.4    P2p
         Fa0/2            Root FWD 19        128.2    P2p
         
         S3#show spanning-tree**
         VLAN0001
           Spanning tree enabled protocol ieee
           Root ID    Priority    32769
             Address     0005.5E75.E646
             Cost        19
             Port        4(FastEthernet0/4)
             Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec

           Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)
             Address     0060.2FED.9DE7
             Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  20

         Interface        Role Sts Cost      Prio.Nbr Type
         ---------------- ---- --- --------- -------- --------------------------------
         Fa0/2            Desg FWD 19        128.2    P2p
         Fa0/4            Root FWD 19        128.4    P2p

#### С учетом выходных данных, поступающих с коммутаторов, ответьте на следующие вопросы.

Какой коммутатор является корневым мостом? \_\__S1_\_\_

Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?

\_\_\_\_\_\_\_\_\__Имеет минимальный MAC-адрес_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Какие порты на коммутаторе являются корневыми портами? \_\_\_\_\_\_\__fa0/2 на S2, fa0/4 на S3_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Какие порты на коммутаторе являются назначенными портами? \_\_\__fa0/2, fa0/4 на S1, fa0/2 на S3_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Какой порт отображается в качестве альтернативного и в настоящее время заблокирован? \_\_\_\_\_\_\_\__fa0/4 на S2_\_\_\_\_\_\_

Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?

\_\_\_\_\__Приоритет больше у порта с меньшим номером_\_\_\_\_\_\_\_\_\_\_\_

 ---
**3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов**

Изменим стоимость порта на коммутаторе с заблокированным портом(S2).Помимо заблокированного порта, единственным активным портом на этом коммутаторе является порт, выделенный в качестве порта корневого моста. Уменьшим стоимость этого порта корневого моста до 18, выполнив команду **spanning-tree cost 18** режима конфигурации интерфейса.

    S2(config)# **interface f0/2**

    S2(config-if)# **spanning-tree cost 18**


Почему протокол spanning-tree заменяет ранее заблокированный порт на назначенный порт и блокирует порт, который был назначенным портом на другом коммутаторе?

\_\__Маршрут до корневого коммутатора через S3->S2->S1 (19+18) становится дешевле чем через S2->S3->S1 (19+19). До этого в приоритете был наименьший MAC._\_\_\_\_\_\_\_\_\_\_


 **Удалим изменения стоимости порта.**
Выполним команду **no spanning-tree cost 18** режима конфигурации интерфейса, чтобы удалить запись стоимости, созданную ранее.

    S2(config)# **interface f0/2**

    S2(config-if)# **no spanning-tree cost 18**
    
---
4. **Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов**

  * Включите порты F0/1 и F0/3 на всех коммутаторах.
  * Подождите 30 секунд, чтобы протокол STP завершил процесс перевода порта, после чего выполните команду **show spanning-tree** на коммутаторах некорневого моста. Обратите внимание, что порт корневого моста переместился на порт с меньшим номером, связанный с коммутатором корневого моста, и заблокировал предыдущий порт корневого моста.
  
![](https://github.com/sefishin/otus_networks/blob/master/labs/lab02/sc2.png)

        S2#show spanning-tree
        VLAN0001
          Spanning tree enabled protocol ieee
          Root ID    Priority    32769
             Address     0005.5E75.E646
             Cost        19
             Port        1(FastEthernet0/1)
             Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec

          Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)
             Address     00D0.D3B6.08C6
             Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  20

        Interface        Role Sts Cost      Prio.Nbr Type
        ---------------- ---- --- --------- -------- --------------------------------
        Fa0/4            Altn BLK 19        128.4    P2p
        Fa0/1            Root FWD 19        128.1    P2p
        Fa0/2            Altn BLK 19        128.2    P2p
        Fa0/3            Altn BLK 19        128.3    P2p
        
        S3#show span
        VLAN0001
          Spanning tree enabled protocol ieee
          Root ID    Priority    32769
             Address     0005.5E75.E646
             Cost        19
             Port        3(FastEthernet0/3)
             Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec

          Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)
             Address     0060.2FED.9DE7
             Hello Time  2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time  20

        Interface        Role Sts Cost      Prio.Nbr Type
        ---------------- ---- --- --------- -------- --------------------------------
        Fa0/1            Desg FWD 19        128.1    P2p
        Fa0/2            Desg FWD 19        128.2    P2p
        Fa0/3            Root FWD 19        128.3    P2p
        Fa0/4            Altn BLK 19        128.4    P2p
        

Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста? \_\_\_\__Fa0/1 на S2  и Fa0/3 на S3_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах?

\_\_\_\_\_\_\_\_\_\__Приоритет больше у порта с меньшим номером_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

1. **Вопросы для повторения**
  1. Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта?

\_\_\_\_\_\__Стоимость порта\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

  1. Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?

\_\_\_\_\__Приоритет порта\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

  1. Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?

\_\_\_\__MAC-адрес\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

 ###  Файлы конфигураций:
 - [S1_config](https://github.com/sefishin/otus_networks/blob/master/labs/lab02/S1.txt)
 - [S2_config](https://github.com/sefishin/otus_networks/blob/master/labs/lab02/S2.txt)
 - [S3_config](https://github.com/sefishin/otus_networks/blob/master/labs/lab02/S3.txt)
